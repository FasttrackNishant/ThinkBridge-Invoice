@page "/invoices-api"
@using ThinkBridge.Client.Components.Domain

<h3>Invoices : Database </h3>
<h4>This in DB Integrated Page : Your Changes will be saved to Azure SQL Database</h4>

@if (invoices == null)
{
    <p>Loading...</p>
}
else
{
    <button @onclick="ShowAddForm">Add Invoice</button>

    @if (showForm)
    {
        <EditForm Model="formInvoice" OnValidSubmit="SaveInvoice">
            <div style="margin-top:10px;">
                <label>Customer Name:</label><br />
                <InputText @bind-Value="formInvoice.CustomerName" /><br /><br />

                <label>Items:</label><br />
                @foreach (var item in formInvoice.Items)
                {
                    <div>
                        Name: <InputText @bind-Value="item.Name" />
                        Price: <InputNumber @bind-Value="item.Price" />
                        <button type="button" @onclick="() => RemoveItem(item)">Remove</button>
                    </div>
                }
                <button type="button" @onclick="AddNewItem">Add Item</button><br /><br />

                <button type="submit">Save</button>
                <button type="button" @onclick="CancelForm">Cancel</button>
            </div>
        </EditForm>
        <hr />
    }

    @foreach (var inv in invoices)
    {
        <div>
            <b>Invoice ID:</b> @inv.InvoiceID <br />
            <b>Customer:</b> @inv.CustomerName <br />

            @if (inv.Items != null && inv.Items.Any())
            {
                <b>Items:</b>
                <ul>
                    @foreach (var item in inv.Items)
                    {
                        <li>@item.Name - @item.Price</li>
                    }
                </ul>
            }

            <button @onclick="() => DeleteInvoice(inv.InvoiceID)">Delete</button>
            <hr />
        </div>
    }
}